<product-card class="product-card" data-product-handle="{{ product.handle }}" data-product-url="{{ product.url }}">
  <script type="application/json" data-product-json>
    {{ product | json }}
  </script>

  
  <div class="product-card__container {% if product.media.size > 1 %}product-card__container--hoverable{% endif %}">
    <div class="product-card__content">
      <div class="product-card__media ">
        {% comment %}
          <div class="--custom-badge-wrapper ">
                    {% if product.metafields.custom.product_badge.value %}
                      {% for badge in product.metafields.custom.product_badge.value limit: 2 %}
                        <span class="--single-badge">
                          {% if forloop.last %}
                            <a href="{{ product.url }}">{{ badge | strip | escape }}</a>
                          {% else %}
                            <a href="{{ product.url }}">{{ badge | strip | escape }}</a>
                          {% endif %}
                        </span>
                      {% endfor %}
                    {% endif %}
                  </div>
        {% endcomment %}

        {% assign first_color_value = '' %}
        {% if product.options_by_name.Color %}
          {% assign first_color_value = product.options_by_name.Color.values.first %}
        {% endif %}
        
        {% assign matched_media = product.media | where: 'alt', first_color_value %}
        {% assign first_variant_with_image = product.variants | where: 'featured_image' | first %}
        {% assign media_index = 0 %}
        {% if first_variant_with_image %}
          {% for m in product.media %}
            {% if m.id == first_variant_with_image.featured_image.id %}
              {% assign media_index = forloop.index0 %}
              {% break %}
            {% endif %}
          {% endfor %}
        {% endif %}
        {% assign next_index = media_index | plus: 1 %}
        <a
          href="{{ product.url }}"
          class="product-card__image-link js-product-link {% if first_color_value != '' and matched_media.size > 1 %}
            has-multiple-media
          {% elsif matched_media.size == 0 and first_variant_with_image and product.media.size > next_index %}
            has-multiple-media-reverse
          {% endif %}"
        >
          {% if first_color_value != '' and matched_media.size > 0 %}
            {% assign first_media = matched_media.first %}
            {% assign variant_for_media = product.variants | where: 'featured_image', first_media | first %}
            {{
              first_media
              | image_url: width: 600
              | image_tag:
                class: 'product-card__primary-image',
                loading: 'lazy',
                widths: '300, 400, 500, 600',
                sizes: '(max-width: 767px) 100vw, 50vw'
            }}
          {% elsif matched_media.size == 0 and first_variant_with_image %}
            {% if product.media.size > next_index %}
              {% assign first_media = product.media[next_index] %}
              {{
                first_media
                | image_url: width: 600
                | image_tag:
                  class: 'product-card__primary-image',
                  loading: 'lazy',
                  widths: '300, 400, 500, 600',
                  sizes: '(max-width: 767px) 100vw, 50vw'
              }}
            {% endif %}
          {% endif %}
        </a>

        <div
          class="product-card__gallery swiper-container--lazy {% if first_color_value != '' and matched_media.size > 1 %}
            has-multiple-media
          {% elsif matched_media.size == 0 and first_variant_with_image and product.media.size > next_index %}
            has-multiple-media-reverse
          {% endif %}"
          data-media-count="{{ product.media.size }}"
          {% if first_color_value != '' and matched_media.size > 1 %}
            data-start="1"
          {% endif %}
          aria-hidden="true"
        >
          <div class="swiper">
            <div class="swiper-wrapper">
              {% if first_color_value != '' %}
                {% if matched_media.size > 0 %}
                  {% for media in matched_media %}
                    {% assign variant_for_media = product.variants | where: 'featured_image', media | first %}
                    <div
                      class="swiper-slide {% if forloop.first %}first-swiper-slide{% elsif forloop.index == 2 %}second-swiper-slide{% endif %}"
                      data-media-id="{{ media.id }}"
                      data-media-position="{{ forloop.index }}"
                      data-variant-id="{{ variant_for_media.id | default: '' }}"
                    >
                      <a href="{% if variant_for_media %}{{ product.url }}?variant={{ variant_for_media.id }}{% elsif product.variants.size > 0 %}{{ product.url }}?variant={{ product.variants.first.id }}{% else %}{{ product.url }}{% endif %}">
                        {{
                          media
                          | image_url: width: 600
                          | image_tag:
                            class: 'product-card__gallery-image swiper-lazy',
                            loading: 'lazy',
                            widths: '300, 400, 500, 600',
                            sizes: '(max-width: 767px) 100vw, 50vw'
                        }}
                      </a>
                    </div>
                  {% endfor %}
                {% else %}
                  {% assign first_variant_with_image = product.variants | where: 'featured_image' | first %}
                  {% if first_variant_with_image %}
                    {% assign media = first_variant_with_image.featured_image %}
                    <div
                      class="swiper-slide first-swiper-slide"
                      data-media-id="{{ media.id }}"
                      data-media-position="1"
                      data-variant-id="{{ first_variant_with_image.id }}"
                    >
                      <a href="{{ product.url }}?variant={{ first_variant_with_image.id }}">
                        {{
                          media
                          | image_url: width: 600
                          | image_tag:
                            class: 'product-card__gallery-image swiper-lazy',
                            loading: 'lazy',
                            widths: '300, 400, 500, 600',
                            sizes: '(max-width: 767px) 100vw, 50vw'
                        }}
                      </a>
                    </div>
                  {% else %}
                    {% assign media = product.media.first %}
                    <div
                      class="swiper-slide first-swiper-slide"
                      data-media-id="{{ media.id }}"
                      data-media-position="1"
                      data-variant-id="{{ product.variants.first.id | default: '' }}"
                    >
                      <a href="{% if product.variants.size > 0 %}{{ product.url }}?variant={{ product.variants.first.id }}{% else %}{{ product.url }}{% endif %}">
                        {{
                          media
                          | image_url: width: 600
                          | image_tag:
                            class: 'product-card__gallery-image swiper-lazy',
                            loading: 'lazy',
                            widths: '300, 400, 500, 600',
                            sizes: '(max-width: 767px) 100vw, 50vw'
                        }}
                      </a>
                    </div>
                  {% endif %}
                {% endif %}
              {% else %}
                {% assign media = product.media.first %}
                <div
                  class="swiper-slide first-swiper-slide"
                  data-media-id="{{ media.id }}"
                  data-media-position="1"
                  data-variant-id="{{ product.variants.first.id | default: '' }}"
                >
                  <a href="{% if product.variants.size > 0 %}{{ product.url }}?variant={{ product.variants.first.id }}{% else %}{{ product.url }}{% endif %}">
                    {{
                      media
                      | image_url: width: 600
                      | image_tag:
                        class: 'product-card__gallery-image swiper-lazy',
                        loading: 'lazy',
                        widths: '300, 400, 500, 600',
                        sizes: '(max-width: 767px) 100vw, 50vw'
                    }}
                  </a>
                </div>
              {% endif %}
            </div>
            <div class="swiper-pagination"></div>
            <button class="swiper-button-prev">{% render 'card-icons', name: 'prev' %}</button>
            <button class="swiper-button-next">{% render 'card-icons', name: 'next' %}</button>
          </div>
        </div>

        {% render 'size-swatch-v1', product: product %}
      </div>

      <div class="product-card__details">
        {% render 'color-swatch-v1', product: product %}
        {% if product.metafields.custom.product_badge.value %}
          <div class="npc__badge__wrap ">
            {% for badge in product.metafields.custom.product_badge.value limit: 2 %}
              <span class="">
                {% if forloop.last %}
                  <a class="npc__pd-attribute npc__pd-attribute-{{ forloop.index }}">
                    {{- badge | strip | escape -}}
                  </a>
                {% else %}
                  <a class="npc__pd-attribute npc__pd-attribute-{{ forloop.index }}">
                    {{- badge | strip | escape -}}
                  </a>
                {% endif %}
              </span>
            {% endfor %}
          </div>
        {% endif %}
        {% comment %}
          {% if product.metafields.custom.product_attribute != blank %}
            <div class="npc__pd-attribute">{{ product.metafields.custom.product_attribute }}</div>
          {% endif %}
        {% endcomment %}
        <div class="product-card__header">
          <h3 class="product-card__title">
            <a href="{{ product.url }}">{{ product.title | escape }}</a>
          </h3>
          {% if product.metafields.descriptors.subtitle %}
            <p class="product-card__subtitle">{{ product.metafields.descriptors.subtitle }}</p>
          {% endif %}
        </div>
        {% render 'selected-color-v1', product: product %}
        <div class="product-card__pricing" data-price-container>
          {% render 'new-price-v1', product: product %}
        </div>
      </div>
    </div>
  </div>
</product-card>
